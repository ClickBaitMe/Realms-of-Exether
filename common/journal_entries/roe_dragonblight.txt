je_dragonblight = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_internal_affairs
	


	#scripted_button = je_positivist_movement_embrace_positivism_button


	# on_weekly_pulse = {
	# 	effect = {
	# 		# clamp_variable = {
	# 		# 	name = positivism_progress_var
	# 		# 	max = 100
	# 		# 	min = 0
	# 		# }
	# 	}
	# }

	on_monthly_pulse = {
		effect = {
			every_scope_state = {
				limit = {
					owner = root
					NOT = { 
						has_modifier = dragon_sickhouses
						has_decree = special_measures
					 }
				}
			every_scope_pop = {
				limit = {
					culture = cu:illvasaari
				}
				change_pop_culture = {
					target = cu:kotskarvi
					value = 0.00145 # je failure graph y = 0.998755^x where y = proportion of dragonborn population and x = months from start
				}
			}
		}
		every_scope_state = {
			limit = {
				owner = root
				OR = {
					has_modifier = gave_into_sickhouse_protests
					has_modifier = active_conversion_cult
				}
				has_modifier = gave_into_sickhouse_protests

				
			}
		every_scope_pop = {
			limit = {
				culture = cu:illvasaari
			}
			change_pop_culture = {
				target = cu:kotskarvi
				value = 0.0012 
			}
		}
		}
			every_scope_state = {
				limit = {
					has_modifier = modifier_active_dragonblight_outbreak
				}
				every_scope_pop = {
					limit = {
						culture = cu:illvasaari
					}
					change_pop_culture = {
						target = cu:kotskarvi
						value = 0.0033
					}
				}
			}	
		}
		random_events = {
			85 = dragonblight_pulse.22 #the collapse event lmao t
			3 = dragonblight_pulse.1 #trade route spread
			4 = dragonblight_pulse.2 #adjacent spread
			2 = dragonblight_pulse.3 #woe be upon ye
			6 = dragonblight_pulse.4 #shoulda took the decision lmao nerd
			7 = dragonblight_pulse.5 #adjacent spread, no health system
			3 = dragonblight_pulse.10 #adjacent-to-kobolds spread
			4 = dragonblight_pulse.6 #heal-by-decree
			4 = dragonblight_pulse.7 #heal, institution + decree
			14 = dragonblight_pulse.8 #heal, vaccine + institution + decree
			8 = dragonblight_pulse.9 #heal vaccine + decree
			6 = dragonblight_pulse.11 #heal, vaccine only
			6 = dragonblight_pulse.12 #rich guys mistress spread event
			7 = dragonblight_pulse.15
			7 = dragonblight_pulse.16
			7 = dragonblight_pulse.17
			7 = dragonblight_pulse.18
			7 = dragonblight_pulse.19
			7 = dragonblight_pulse.20
			6 = dragonblight_pulse.21 #kobold pogrom
		}
	}

	complete = {
		NOT= {
			any_scope_state = {
				has_modifier = modifier_active_dragonblight_outbreak
			}
		}
		has_variable = dragonblight_vaccine #todo
	}	

	on_complete = {
		#remove_modifier = dragonblight_blues #todo
		#trigger_event = {
		#	id = dragonblight.not
		}

	fail = {
		OR = {
			culture_percent_country = {
				target = cu:illvasaari
				value <= 0.33
			}
			AND = {
				culture_percent_country = {
					target = cu:illvasaari
					value <= 0.5
				}
				s:STATE_KLYPYRA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_ZAMARIS = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_ZARTHOS = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_CALTHA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_SIGARA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_LEPTISCA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_OYRSA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_LEPIDRA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_THASPYR = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_LILYBAEUM = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_ZYRAS = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_MOTHYA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_LEPTHAR = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_CLYPYA = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
				s:STATE_CARTHI = {
					any_scope_state = {
						OR = {
							culture_percent_state = {
								target = cu:illvasaari
								value <= 0.4
							}
							NOT = { owner = ROOT }
						}
					}
				}
			}
		}
	}
	

	# current_value = {
	# 	#value = root.var:positivism_progress_var
	# }

	# goal_add_value = {
	# 	add = 100
	# }

	weight = 1000

	should_be_pinned_by_default = yes
}

je_dragonblight_vaccine = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_internal_affairs
	
	immediate = {

	}

	scripted_progress_bar = dragonblight_vaccine_progress_bar
	


	on_weekly_pulse = {
		effect = {

		}
	}

	on_monthly_pulse = {
		
		random_events = {
			# 100 = 0
			# 10 = positivism_pulse.1
			# 10 = positivism_pulse.2
			# 10 = positivism_pulse.3
			# 10 = positivism_pulse.4
			# 10 = positivism_pulse.5
			# 10 = bp1_misc.3
		}
	}

	complete = {
		custom_tooltip = {
			text = dragonblight_vaccine_full_tt
			scope:journal_entry = {
				"scripted_bar_progress(dragonblight_vaccine_progress_bar)" >= 100
			}
		}
	}	

	on_complete = {
		set_variable = dragonblight_vaccine
		trigger_event = {
		#	id = dragonblight.not
		}
	}

	weight = 100

	should_be_pinned_by_default = yes
}
