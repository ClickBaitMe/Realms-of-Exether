je_dragonblight = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_internal_affairs
	
	immediate = {

	}

	#scripted_button = je_positivist_movement_embrace_positivism_button


	on_weekly_pulse = {
		effect = {
			# clamp_variable = {
			# 	name = positivism_progress_var
			# 	max = 100
			# 	min = 0
			# }
		}
	}

	on_monthly_pulse = {
		effect = {
			every_scope_state = {
				limit = {
					owner = root
					NOT = { 
						has_modifier = dragon_sickhouses
						has_decree = special_measures
					 }
				}
			every_scope_pop = {
				limit = {
					culture = cu:illvasaari
				}
				change_pop_culture = {
					target = cu:kotskarvi
					value = 0.00145 # je failure graph y = 0.998755^x where y = proportion of dragonborn population and x = months from start
				}
			}
		}
		every_scope_state = {
			limit = {
				owner = root
				OR = {
					has_modifier = gave_into_sickhouse_protests
					has_modifier = active_conversion_cult
				}
				has_modifier = gave_into_sickhouse_protests

				
			}
		every_scope_pop = {
			limit = {
				culture = cu:illvasaari
			}
			change_pop_culture = {
				target = cu:kotskarvi
				value = 0.0012 
			}
		}
		}
			every_scope_state = {
				limit = {
					has_modifier = modifier_active_dragonblight_outbreak
				}
				every_scope_pop = {
					limit = {
						culture = cu:illvasaari
					}
					change_pop_culture = {
						target = cu:kotskarvi
						value = 0.0029
					}
				}
			}	
		}
		random_events = {
			# 100 = 0
			3 = dragonblight_pulse.1
			4 = dragonblight_pulse.2
			2 = dragonblight_pulse.3
			5 = dragonblight_pulse.4
			7 = dragonblight_pulse.5
			4 = dragonblight_pulse.6 #heal-by-decree
			4 = dragonblight_pulse.7 #heal, institution + decree
			14 = dragonblight_pulse.8 #heal, vaccine + institution + decree

		}
	}

	complete = {
		NOT= {
			any_scope_state = {
				has_modifier = modifier_active_dragonblight_outbreak
			}
		}
		has_variable = dragonblight_vaccine #todo
	}	

	on_complete = {
		remove_modifier = dragonblight_blues #todo
		trigger_event = {
		#	id = dragonblight.not
		}
	}

	

	# current_value = {
	# 	#value = root.var:positivism_progress_var
	# }

	# goal_add_value = {
	# 	add = 100
	# }

	weight = 100

	progressbar = yes

	should_be_pinned_by_default = yes
}

je_dragonblight_vaccine = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_internal_affairs
	
	immediate = {

	}

	scripted_progress_bar = dragonblight_vaccine_progress_bar
	


	on_weekly_pulse = {
		effect = {

		}
	}

	on_monthly_pulse = {
		
		random_events = {
			# 100 = 0
			# 10 = positivism_pulse.1
			# 10 = positivism_pulse.2
			# 10 = positivism_pulse.3
			# 10 = positivism_pulse.4
			# 10 = positivism_pulse.5
			# 10 = bp1_misc.3
		}
	}

	complete = {
		custom_tooltip = {
			text = dragonblight_vaccine_full_tt
			scope:journal_entry = {
				"scripted_bar_progress(dragonblight_vaccine_progress_bar)" >= 100
			}
		}
	}	

	on_complete = {
		set_variable = dragonblight_vaccine
		trigger_event = {
		#	id = dragonblight.not
		}
	}

	weight = 100

	should_be_pinned_by_default = yes
}
